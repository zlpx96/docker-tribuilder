#!/bin/bash
set -e

if [ "_$NO_RM" = _ ]; then
    RM="--rm"
fi

if [ "_$NO_DIND" = _ ]; then
    DIND="-v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker:/var/lib/docker"
fi

if [ "_$AIRSDK" = _ ]; then
    AIRSDK=latest
fi

docker run \
    $DIND $RM -it \
    -e CONFIG_PLATFORM_TYPE=$CONFIG_PLATFORM_TYPE \
    -e CONFIG_PLATFORM_OS=$CONFIG_PLATFORM_OS \
    -e CONFIG_PLATFORM_TARGET=$CONFIG_PLATFORM_TARGET \
    -e CONFIG_PROJECT_ROOT=$CONFIG_PROJECT_ROOT \
    -e CONFIG_FLEX_SDK=$CONFIG_FLEX_SDK \
    -e CONFIG_ANDROID_SDK=$CONFIG_ANDROID_SDK \
    -e CONFIG_LIBS_ROOT=$CONFIG_LIBS_ROOT \
    -e CONFIG_IOSDEPLOY=$CONFIG_IOSDEPLOY \
    -e CONFIG_KEYSTORE_ANDROID_DEBUG=$CONFIG_KEYSTORE_ANDROID_DEBUG \
    -e CONFIG_STOREPASS_ANDROID_DEBUG=$CONFIG_STOREPASS_ANDROID_DEBUG \
    -e CONFIG_KEYSTORE_ANDROID_RELEASE=$CONFIG_KEYSTORE_ANDROID_RELEASE \
    -e CONFIG_STOREPASS_ANDROID_RELEASE=$CONFIG_STOREPASS_ANDROID_RELEASE \
    -e CONFIG_PROVISIONING_IOS_DEBUG=$CONFIG_PROVISIONING_IOS_DEBUG \
    -e CONFIG_KEYSTORE_IOS_DEBUG=$CONFIG_KEYSTORE_IOS_DEBUG \
    -e CONFIG_STOREPASS_IOS_DEBUG=$CONFIG_STOREPASS_IOS_DEBUG \
    -e CONFIG_PROVISIONING_IOS_RELEASE=$CONFIG_PROVISIONING_IOS_RELEASE \
    -e CONFIG_KEYSTORE_IOS_RELEASE=$CONFIG_KEYSTORE_IOS_RELEASE \
    -e CONFIG_STOREPASS_IOS_RELEASE=$CONFIG_STOREPASS_IOS_RELEASE \
    -v $(pwd):$(pwd) -w $(pwd) --hostname tribuilder jeko/tribuilder:$AIRSDK "$@"
